generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

//
// -------------------- USER ---------------------
//
model users {
  id          String        @id @default(auto()) @map("_id") @db.ObjectId
  name        String?
  email       String?       @unique
  password    String?
  followings  String[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  shopReviews shopReviews[]
  orders    Orders[]
  images Images[] // general images for user
}


//
// -------------------- IMAGE ---------------------
//
model Images {
  id        String  @id @default(auto()) @map("_id") @db.ObjectId
  file_id   String
  url       String
  userId    String? @db.ObjectId
  shopId    String? @db.ObjectId
  productId String? @db.ObjectId

  user    users?   @relation(fields: [userId], references: [id])
  shops   Shops?   @relation(fields: [shopId], references: [id])
  product Product? @relation(fields: [productId], references: [id])
}

//
// -------------------- SELLER ---------------------
//
model sellers {
  id           String  @id @default(auto()) @map("_id") @db.ObjectId
  name         String
  email        String? @unique
  storeName    String?
  password     String
  country      String
  phone_number String
  stripeId     String?

  shop   Shops?
  shopId String? @unique @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

//
// -------------------- SHOP ---------------------
//
model Shops {
  id       String  @id @default(auto()) @map("_id") @db.ObjectId
  name     String
  bio      String?
  category String?
  country  String?
  followers ShopFollowers[]
  coverBanner   String?
  address       String?
  opining_hours String?
  webSite       String?
  socialLinks   Json[]
  avatar       String?
  ratings       Float         @default(0)
  reviews       shopReviews[]
  sellerId      String        @unique @db.ObjectId
  seller        sellers       @relation(fields: [sellerId], references: [id])
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  products Product[]
  images   Images[]
    orders        Orders[]
}

model shopReviews {
  id     String  @id @default(auto()) @map("_id") @db.ObjectId
  userId String? @unique @db.ObjectId
  user   users?  @relation(fields: [userId], references: [id])

  ratings Float
  reviews String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  shopId    String?  @unique @db.ObjectId

  shops Shops? @relation(fields: [shopId], references: [id])
}

//
// -------------------- ENUM ---------------------
//
enum UserRole {
  user
  seller
  admin
}

model site_config {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  categories  String[]
  subCategory Json
}

model discount_codes {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  public_name    String
  discount_type  String
  discount_value Float
  discount_code  String   @unique
  sellerId       String   @db.ObjectId
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

enum ProductStatus {
  active
  pending
  Draft
  out_of_stock
  discontinued
}

model Product {
  id                    String    @id @default(auto()) @map("_id") @db.ObjectId
  title                 String
  slug                  String    @unique
  category              String
  subCategory           String
  short_description     String
  detailed_description  String
  images                Images[]
  video_Url             String?
  tags                  String[]
  brand                 String?
  colors                String[]
  sizes                 String[]
  starting_date         DateTime?
  ending_date           DateTime?
  stock                 Int
  regular_price         Float
  sale_price            Float
  rating                Float     @default(5)
  warranty              String
  custom_specifications Json?
  customProperties      Json?
  isDeleted             Boolean?  @default(false)
  cashOnDelivery        String?
  discount_codes        String[]  @db.ObjectId
  status                String    @default("active")
  shopId                String    @db.ObjectId
  shop                  Shops     @relation(fields: [shopId], references: [id])
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  deletedAt             DateTime?
  orderItems OrderItem[]

}

model UserAnalytics {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @unique

  actions Json

  country   String?
  city      String?
  latitude  Float?
  longitude Float?

  lastVisited DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ProductAnalytics {
  id        String  @id @default(auto()) @map("_id") @db.ObjectId
  productId String  @unique
  shopId    String?

  views              Int @default(0)
  cartAdds           Int @default(0)
  wishlistAdds       Int @default(0)
  purchases          Int @default(0)
  cartRemovals       Int @default(0)
  removeFromCart     Int @default(0) // Add this
  removeFromWishlist Int @default(0) // Add this
  quantityDecreases  Int @default(0) // Add this

  lastVisited DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ShopFollowers {
  id      String @id @default(auto()) @map("_id") @db.ObjectId
  shopId  String @db.ObjectId
  userId  String @db.ObjectId
  shop    Shops  @relation(fields: [shopId], references: [id])
  createdAt DateTime @default(now())
}

model Orders {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId

  userId      String   @db.ObjectId
  shopId      String   @db.ObjectId

  total       Float
  status      OrderStatus @default(PENDING)
  paymentType PaymentType

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // relations
  user        users    @relation(fields: [userId], references: [id])
  shop        Shops    @relation(fields: [shopId], references: [id])
  items       OrderItem[]
}

model OrderItem {
  id        String  @id @default(auto()) @map("_id") @db.ObjectId
  orderId  String  @db.ObjectId
  productId String @db.ObjectId

  quantity Int
  price    Float

  order    Orders  @relation(fields: [orderId], references: [id])
  product  Product @relation(fields: [productId], references: [id])
}

enum OrderStatus {
  PENDING
  PAID
  SHIPPED
  DELIVERED
  CANCELED
}

enum PaymentType {
  STRIPE
  PAYPAL
  COD
}
